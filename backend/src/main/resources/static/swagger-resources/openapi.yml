openapi: 3.0.3

info:
  title: OptiFI REST API
  version: "1.0"
  description: >
    RESTful API for personal finance management application.

servers:
  - url: http://localhost:8080
  - url: https://optifi.kvtmail.com

tags:
  - name: Auth
    description: Authentication endpoints

security:
  - bearerAuth: []

paths:

  /api/auth/register:
    post:
      tags: [Auth]
      summary: Register user
      description: Public endpoint. Creates a new user account.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserCreateDto"
      responses:
        "201":
          description: User created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponseDto"
        "400":
          description: Validation failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "409":
          description: Duplicate user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/auth/login:
    post:
      tags: [Auth]
      summary: Login
      description: Public endpoint. Returns JWT token.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequestDto"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponseDto"
        "400":
          description: Validation failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    LoginRequestDto:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          example: john
        password:
          type: string
          example: Passw0rd!

    LoginResponseDto:
      type: object
      properties:
        token:
          type: string
          example: eyJhbGciOiJIUzI1NiJ9...
        type:
          type: string
          example: Bearer
        userId:
          type: integer
          format: int64
          example: 2
        username:
          type: string
          example: john

    UserCreateDto:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 32
          example: john
        password:
          type: string
          minLength: 6
          maxLength: 32
          example: Passw0rd!

    UserResponseDto:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 2
        username:
          type: string
          example: john
        role:
          type: string
          example: USER
        createdAt:
          type: string
          format: date-time
          example: "2025-12-14T12:00:00"


    ApiError:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
          example: "2025-12-14T10:30:00"
        status:
          type: integer
          example: 400
        error:
          type: string
          example: Bad Request
        message:
          type: string
          example: Validation failed
        fieldErrors:
          type: object
          nullable: true
          additionalProperties:
            type: string
